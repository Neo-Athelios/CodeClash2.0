<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NutriSense - Indian Nutrition Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
      /* ========== GLOBAL STYLES ========== */
      :root {
        --primary: #4caf50;
        --primary-dark: #388e3c;
        --secondary: #ff9800;
        --light: #f8f9fa;
        --dark: #212529;
        --gray: #6c757d;
        --light-gray: #e9ecef;
        --white: #ffffff;
        --primary-light: #e3fcec;
        --secondary-light: #fffbe7;
        --healthy-green: #4CAF50;
        --nutrient-blue: #2196F3;
        --fiber-orange: #FF9800;
        --protein-purple: #9C27B0;
        --sugar-red: #F44336;
      }
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html { scroll-behavior: smooth; }
      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--light);
        color: var(--dark);
        line-height: 1.6;
      }
      h1, h2, h3, h4 {
        font-family: "Playfair Display", serif;
        font-weight: 600;
      }
      .container {
        width: 90%;
        max-width: 1200px;
        margin: 0 auto;
        padding: 10px 0;
      }
      .btn {
        display: inline-block;
        padding: 12px 24px;
        border-radius: 50px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      .btn-primary {
        background-color: var(--primary);
        color: white;
      }
      .btn-primary:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }

/* ========== HEADER & NAVIGATION ========== */
.header {
    background-color: var(--white);
    padding: 15px 0;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
    border-bottom: 1px solid var(--light-gray);
}

.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-size: 1.8rem;
    font-weight: 700;
    color: var(--primary-dark);
    display: flex;
    align-items: center;
}

.logo i {
    margin-right: 8px;
    color: var(--secondary);
}

.nav-links {
    list-style: none;
    display: flex;
}

.nav-links li {
    margin-left: 30px;
}

.nav-links a {
    color: var(--dark);
    font-weight: 500;
    transition: color 0.3s ease;
}

.nav-links a:hover {
    color: var(--primary);
}

.mobile-menu-btn {
    display: none;
    font-size: 1.8rem;
    color: var(--dark);
    cursor: pointer;
}

/* Mobile Navigation */
@media (max-width: 768px) {
    .nav-links {
        display: none;
        flex-direction: column;
        width: 100%;
        background-color: var(--white);
        position: absolute;
        top: 70px;
        left: 0;
        box-shadow: 0 8px 10px rgba(0, 0, 0, 0.05);
        padding: 20px 0;
    }

    .nav-links.active {
        display: flex;
    }

    .nav-links li {
        margin: 10px 0;
        text-align: center;
    }

    .mobile-menu-btn {
        display: block;
    }
}

      /* HERO SECTION STYLES */
      .hero {
        background: url("https://images.unsplash.com/photo-1546069901-ba9599a7e63c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2080&q=80") no-repeat center center/cover;
        height: 350px; /* Reduced height to optimality */
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        color: white;
        text-align: center;
      }
      .hero::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
      }
      .hero-content {
        position: relative;
        z-index: 1;
        max-width: 800px;
      }
      .hero h1 {
        font-size: 3.5rem;
        margin-bottom: 20px;
        line-height: 1.2;
      }
      .hero p {
        font-size: 1.2rem;
        margin-bottom: 30px;
      }
      .pulse { animation: pulse 2s infinite; }
      @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7); }
        70% { box-shadow: 0 0 0 15px rgba(255, 255, 255, 0); }
        100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0); }
      }

      /* ========== HEALTHY QUOTES SECTION ========== */
      .quote-section {
        padding: 4rem 0;
        background-color: #f0fdf4;
        text-align: center;
        position: relative;
      }
      .quote-section::before {
          content: "";
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgeG1sbnM9Imh0dHA6Ly93d3cuc2hhcGUuY29tL3Byb2R1Y3RzL2ZsaWNrciI+CiAgPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiBmaWxsPSIjRkRGM0Z hoe should i remove this background images that is automatically generated.');
          background-repeat: repeat;
          background-size: 10px 10px;
          opacity: 0.1;
          z-index: 0;
      }
      .quote-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 0 20px;
        height: 100px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        z-index: 1;
      }
      .quote-text {
        font-size: 1.5rem;
        font-style: italic;
        color: var(--primary-dark);
        font-family: "Playfair Display", serif;
      }

      /* ========== SEARCH SECTION ========== */
      .search-section {
        padding: 1rem 0;
        border-radius: 10px;
        text-align: center;
        background-color: var(--white);
      }
      .search-container {
        position: relative;
        width: 100%;
        max-width: 600px;
        margin: 0 auto;
      }
      .main-search-bar {
        width: 100%;
        padding: 20px 25px;
        font-size: 1.2rem;
        border-radius: 50px;
        border: 2px solid var(--light-gray);
        outline: none;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
      }
      .main-search-bar:focus {
        border-color: var(--primary);
        box-shadow: 0 5px 15px rgba(76, 175, 80, 0.2);
      }

      /* NEW: Search results container */
      #search-results-container {
        max-width: 600px;
        margin: 1rem auto 0;
        text-align: left;
        background: var(--white);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .search-result-item {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        padding: 15px 20px;
        border-bottom: 1px solid var(--light-gray);
        transition: background-color 0.3s ease;
      }
      .search-result-item:last-child { border-bottom: none; }
      .search-result-item:hover { background-color: #f0fdf4; }
      .food-name {
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 5px;
      }
      .food-details {
        font-size: 0.9rem;
        color: var(--gray);
      }
      .no-results {
        padding: 20px;
        color: var(--gray);
        text-align: center;
      }

      /* Filter Section Styles */
      .filters-section {
        margin-bottom: 2rem;
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        justify-content: center;
        text-align: left;
      }
      .filter-group {
        background-color: var(--white);
        padding: 1.5rem;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        flex: 1 1 280px;
        min-width: 250px;
      }
      .filter-group h3 {
        font-size: 1.3rem;
        color: var(--primary-dark);
        margin-bottom: 1rem;
        border-bottom: 1px solid var(--light-gray);
        padding-bottom: 0.5rem;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .filter-group h3 i { transition: transform 0.2s ease-in-out; }
      .filter-group h3.collapsed i { transform: rotate(-90deg); }
      .filter-group .filter-options { display: block; }
      .filter-group .filter-options.hidden { display: none; }
      .filter-options label {
        display: block;
        margin-bottom: 0.7rem;
        font-size: 0.95rem;
        color: var(--dark);
        cursor: pointer;
      }
      .filter-options input[type="checkbox"],
      .filter-options input[type="radio"] {
        margin-right: 8px;
        accent-color: var(--primary);
      }
      .filter-options .btn {
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 0.9rem;
        margin-right: 10px;
        margin-bottom: 10px;
        background-color: var(--light-gray);
        color: var(--dark);
        border: 1px solid var(--gray);
      }
      .filter-options .btn.active {
        background-color: var(--primary);
        color: var(--white);
        border-color: var(--primary-dark);
      }
      .sort-options {
        margin-top: 1.5rem;
        text-align: right;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 15px;
        flex-wrap: wrap;
      }
      .sort-options label {
        font-weight: 500;
        margin-right: 0;
        color: var(--dark);
      }
      .sort-options select {
        padding: 8px 12px;
        border-radius: 5px;
        border: 1px solid var(--gray);
        background-color: var(--white);
        font-size: 0.95rem;
        cursor: pointer;
        outline: none;
        transition: border-color 0.2s;
      }
      .sort-options select:focus { border-color: var(--primary); }
      .clear-filters-btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: var(--secondary);
        color: white;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        font-weight: 600;
        transition: background-color 0.2s;
      }
      .clear-filters-btn:hover { background-color: #e68900; }

      /* Active Filters Summary */
      #active-filters-summary {
          margin-bottom: 1rem;
          text-align: left;
          font-size: 0.9rem;
          color: var(--gray);
          min-height: 20px;
      }
      .filter-tag {
          display: inline-flex;
          align-items: center;
          background-color: var(--primary-light);
          color: var(--primary-dark);
          padding: 5px 10px;
          border-radius: 15px;
          margin-right: 8px;
          margin-bottom: 8px;
          border: 1px solid var(--primary);
          font-weight: 500;
      }
      .filter-tag i {
          margin-left: 8px;
          cursor: pointer;
          color: var(--gray);
          transition: color 0.2s;
      }
      .filter-tag i:hover { color: var(--dark); }

      /* Nutrient Badges (with Icons) */
      .food-details .badge {
          display: inline-flex; /* Use flex to center icon */
          align-items: center;
          justify-content: center;
          width: 20px; /* Increased size for icon */
          height: 20px; /* Increased size for icon */
          border-radius: 50%;
          margin-left: 5px;
          vertical-align: middle;
          border: 1px solid rgba(0,0,0,0.1);
          color: white; /* Icon color */
          font-size: 0.7rem; /* Icon size */
      }
      .badge-low-calorie { background-color: var(--healthy-green); }
      .badge-moderate-calorie { background-color: #FFC107; } /* Not currently used as a badge */
      .badge-high-calorie { background-color: var(--sugar-red); }
      .badge-high-protein { background-color: var(--protein-purple); }
      .badge-low-fat { background-color: var(--healthy-green); }
      .badge-high-fibre { background-color: var(--fiber-orange); }
      .badge-low-sugar { background-color: var(--healthy-green); }
      .badge-high-nutrient { background-color: var(--nutrient-blue); }

      /* Pagination Styles */
      .pagination {
          display: flex;
          justify-content: center;
          align-items: center;
          margin-top: 2rem;
          gap: 10px;
          flex-wrap: wrap;
      }
      .pagination button {
          background-color: var(--primary-light);
          color: var(--primary-dark);
          border: 1px solid var(--primary);
          padding: 8px 15px;
          border-radius: 5px;
          cursor: pointer;
          transition: background-color 0.2s, color 0.2s;
          font-weight: 500;
      }
      .pagination button:hover:not(.active):not(:disabled) {
          background-color: var(--primary);
          color: var(--white);
      }
      .pagination button.active {
          background-color: var(--primary);
          color: var(--white);
          border-color: var(--primary-dark);
          font-weight: 700;
      }
      .pagination button:disabled {
          background-color: var(--light-gray);
          color: var(--gray);
          cursor: not-allowed;
          border-color: var(--light-gray);
      }

      /* Loading Spinner */
      .loading-spinner {
        text-align: center;
        padding: 20px;
        font-size: 1.1rem;
        color: var(--gray);
      }
      .loading-spinner i { margin-right: 10px; }

      /* Contextual Tips */
      .contextual-tip {
        margin-top: 1rem;
        padding: 15px;
        background-color: var(--secondary-light);
        border-radius: 8px;
        border: 1px dashed var(--secondary);
        font-size: 0.9rem;
        color: var(--dark);
      }
      .contextual-tip p { margin-bottom: 5px; }
      .contextual-tip p:last-child { margin-bottom: 0; }
      .contextual-tip i { margin-right: 5px; color: var(--secondary); }


      /* ========== RESPONSIVE DESIGN ========== */
      @media (max-width: 900px) {
        .hero h1 { font-size: 2.5rem; }
        .filters-section {
          flex-direction: column;
          gap: 1rem;
          align-items: center;
        }
        .filter-group {
          width: 95%;
          min-width: unset;
        }
        .sort-options {
          text-align: center;
          justify-content: center;
        }
        .sort-options select, .clear-filters-btn { width: 100%; }
      }

      @media (max-width: 768px) {
        .nav-links {
          display: none;
          position: absolute;
          top: 100%;
          left: 0;
          width: 100%;
          background-color: var(--primary-dark);
          flex-direction: column;
          padding: 10px 0;
        }
        .nav-links.active { display: flex; }
        .nav-links li {
          margin: 10px 0;
          text-align: center;
        }
        .mobile-menu-btn { display: block; }
        .logo span.tagline { display: none; } /* Hide tagline on very small screens if space is tight */
      }
      /* NEW: Popular Dishes Section */
      .popular-dishes-section {
        padding: 4rem 0;
        background-color: var(--primary-light);
        text-align: center;
      }

      .popular-dishes-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 25px;
        max-width: 1000px;
        margin: 0 auto;
      }

      .dish-card {
        background: rgba(255, 255, 255, 0.2); /* Semi-transparent background */
        backdrop-filter: blur(10px); /* Glass effect */
        -webkit-backdrop-filter: blur(10px); /* For Safari support */
        border-radius: 16px; /* Slightly more rounded for glass */
        border: 1px solid rgba(255, 255, 255, 0.3); /* Subtle border */
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1); /* Enhanced shadow for depth */
        transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding-bottom: 15px; /* Space for text below image */
        position: relative; /* Needed for potential future overlays/details */
        overflow: hidden; /* Ensure content respects border-radius */
      }

      .dish-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0) 100%);
        pointer-events: none; /* Allows clicks to pass through */
        z-index: 1; /* Above background, below content */
      }

      .dish-card:hover {
        transform: translateY(-8px); /* More pronounced lift */
        box-shadow: 0 12px 40px 0 rgba(0, 0, 0, 0.2); /* Stronger shadow */
        background: rgba(255, 255, 255, 0.3); /* Slightly more opaque on hover */
      }

      .dish-card-image {
        width: 100%;
        height: 150px; /* Fixed height for consistent look */
        object-fit: cover; /* Cover the area, crop if necessary */
        border-radius: 15px 15px 0 0; /* Match card radius on top */
        z-index: 2; /* Ensure image is above the '::before' pseudo-element */
      }

      .dish-card-name {
        font-family: "Playfair Display", serif;
        font-weight: 700; /* Bolder for better readability on glass */
        color: var(--primary-dark); /* Keep color for contrast */
        margin-top: 15px;
        margin-bottom: 5px;
        font-size: 1.2rem; /* Slightly larger */
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); /* Subtle text shadow */
        z-index: 2;
      }

      .dish-card-details {
        font-size: 0.95rem; /* Slightly larger */
        color: var(--dark); /* Darker for better contrast */
        margin-bottom: 10px;
        z-index: 2;
      }

      /* Responsive adjustments for smaller screens */
      @media (max-width: 600px) {
          .popular-dishes-grid {
              grid-template-columns: 1fr; /* Single column on very small screens */
          }
          .dish-card-image {
              height: 180px; /* Slightly taller for single column */
          }
      }
      .all-dishes-list-container {
    background: rgba(255, 255, 255, 0.15); /* Slightly transparent background */
    backdrop-filter: blur(10px); /* Glassmorphism blur effect */
    -webkit-backdrop-filter: blur(10px); /* For Safari support */
    border: 1px solid rgba(255, 255, 255, 0.18); /* Subtle border */
    border-radius: 15px; /* Rounded corners */
    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1); /* Soft shadow */
    padding: 2rem;
    margin-top: 1.5rem; /* Add some space from the heading */
}

/* Styling for the hyperlinked texts (dish names) */
.all-dishes-list li {
    cursor: pointer; /* Indicates it's clickable */
    padding: 8px 0;
    border-bottom: 1px dashed var(--light-gray); /* Subtle separator */
    transition: color 0.3s ease, text-decoration 0.3s ease;
}

.all-dishes-list li:last-child {
    border-bottom: none; /* No border for the last item */
}

.all-dishes-list .all-dish-name {
    color: var(--primary-dark); /* A distinct color for the link */
    text-decoration: none; /* Start with no underline */
    font-weight: 500;
}

.all-dishes-list .all-dish-name {
    color: var(--secondary); /* Change color on hover */
    text-decoration: underline; /* Add underline on hover */
}
/* Example for subtle glass effect on list items on hover */
.all-dishes-list li:hover {
    background: rgba(255, 255, 255, 0.05); /* Very subtle transparency */
    backdrop-filter: blur(2px); /* Very slight blur for the item itself */
    -webkit-backdrop-filter: blur(2px);
    border-radius: 8px; /* Match container or smaller */
    transform: translateY(-2px); /* Slight lift */
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08); /* Soft shadow */
}
/* All Dishes Local Search */
.all-dishes-search-wrapper {
    position: relative;
    margin-bottom: 2rem;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
}

.all-dishes-search-wrapper input {
    width: 100%;
    padding: 12px 15px 12px 45px; /* Adjust padding for icon */
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    font-size: 1rem;
    color: var(--dark);
    outline: none;
    /* Basic glassmorphism for input */
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}

.all-dishes-search-wrapper input::placeholder {
    color: var(--gray);
}

.all-dishes-search-wrapper input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
}

.all-dishes-search-wrapper .search-icon {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
}

/* Alphabet Jump Links */
.alphabet-jump-links {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-bottom: 2rem;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(5px);
    border-radius: 10px;
    padding: 15px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 2px 15px rgba(0,0,0,0.05);
}

.alphabet-jump-link {
    cursor: pointer;
    font-weight: bold;
    color: var(--primary-dark);
    padding: 5px 10px;
    border-radius: 5px;
    transition: background-color 0.3s ease, color 0.3s ease;
}

.alphabet-jump-link:hover {
    background-color: var(--primary-light);
    color: var(--primary);
}

/* Grouped List Headers */
.all-dishes-group-header {
    background: rgba(255, 255, 255, 0.2); /* Slightly darker glass for headers */
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    padding: 10px 20px;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    font-size: 1.8rem;
    color: var(--primary-dark);
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.all-dishes-group-header:hover {
    background: rgba(255, 255, 255, 0.3);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.all-dishes-group-header i {
    transition: transform 0.3s ease;
}

.all-dishes-group-header.collapsed i {
    transform: rotate(-90deg); /* Rotate icon when collapsed */
}

.all-dishes-group-list {
    list-style: none;
    padding: 0;
    margin: 0;
    max-height: 500px; /* Or a suitable height */
    overflow-y: auto; /* Scroll if content overflows */
    transition: max-height 0.3s ease-out; /* Smooth collapse/expand */
}

.all-dishes-group-list.hidden {
    max-height: 0;
    overflow: hidden;
}

/* Ensure existing list item styles are compatible */
.all-dishes-group-list li {
    display: flex; /* Use flexbox for alignment */
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    border-bottom: 1px dashed rgba(0, 0, 0, 0.1);
    /* Add subtle glass effect to individual items for extra polish */
    background: rgba(255, 255, 255, 0.05); /* Very slight transparency */
    transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
}

.all-dishes-group-list li:hover {
    background-color: rgba(255, 255, 255, 0.15); /* More visible on hover */
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
}
#goToTop {
    background-color:#FF9800;
    color: black;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 2rem;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.18);
    transition: background 0.2s, transform 0.2s;
    z-index: 1001;
    outline: none;
}
#goToTop:hover {
    background-color: var(--primary-dark);
    color: black;
    transform: translateY(-3px) scale(1.08);
}
#scrollPercentage {
    position: fixed;
    bottom: 90px;
    right: 20px;
    background-color: #FF9800;
    color: black;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 16px;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}
#floatingControls {
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}
#detailed-info-table tbody tr:hover {
    background-color:  #d6d4f3a8 !important;
    color: var(--dark) !important;
    transition: background 0.2s, color 0.2s;
}
.card {
            background-color: #d6d4f3a8;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin: auto;
            text-align: center;
        }
    </style>
  </head>
  <body>
    <div class="card">>
    <header id="mainHeader" style="box-shadow: 0 4px 18px rgba(0,0,0,0.08); overflow: hidden; margin: 0; width: 100vw; left: 0; right: 0; top: 0; position: fixed; z-index: 1100; background: #404041d4; color: #fff; border-radius: 0;">
        <div class="container" style="max-width: 1200px; margin: 0 auto;">
            <nav class="navbar" style="color: #fff;">
                <a href="https://neo-athelios.github.io/CodeClash2.0/" class="logo" style="color: #fff;">
                    <i class="fas fa-leaf" style="color: #FF9800;"></i>
                    <span>NutriSense<span class="tagline"> - Indian Nutrition Tracker</span></span>
                </a>
                <button class="mobile-menu-btn" id="mobileMenuBtn" style="color: #fff;">
                    <i class="fas fa-bars"></i>
                </button>
                <ul class="nav-links" id="navLinks" style="color: #fff;">
                    <li><a href="#heroSection" class="active pulse" style="color: #fff;">Home</a></li>
                    <li><a href="#search" class="pulse" style="color: #fff;">Search</a></li>
                    <li><a href="#about-us" class="pulse" style="color: #fff;">About Us</a></li>
                    <li><a href="#contact-us" class="pulse" style="color: #fff;">Contact Us</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <div style="height: 90px;"></div>
    
     <section class="hero" id="heroSection" style="padding-bottom: 0; border-radius: 18px 18px 18px 18px; overflow: hidden; margin-bottom: 0; height: auto; min-height: 220px;">
        <div class="hero-content animate__animated animate__fadeIn" style="--animate-duration: 3s; background: rgba(0,0,0,0.45); border-radius: 14px; padding: 32px 24px 24px; box-shadow: 0 6px 24px rgba(0,0,0,0.10);">
            <h1 style="font-size: 2.8rem; margin-bottom: 18px; color: #fff; text-shadow: 0 2px 12px rgba(0,0,0,0.25);">Eat Healthy, Live Strong</h1>
            <p style="font-size: 1.15rem; margin-bottom: 28px; color: #f8f9fa; text-shadow: 0 1px 6px rgba(0,0,0,0.18);">
                Track Your <b>Indian Meals</b>. Discover authentic recipes, and achieve your wellness goals with <span style="color: #FF9800; font-weight: 600;">NutriSense</span>: Your Guide to Healthy Indian Eating.
            </p>
            <a href="#search" class="btn btn-primary pulse" style="font-size: 1.1rem;">Get Started</a>
            <br><br>
            <div class="quote-container" style="background: rgba(255,255,255,0.75); box-shadow: 0 2px 12px rgba(76,175,80,0.10); border-radius: 20px; min-height: 50px; display: flex; align-items: center; justify-content: center; transition: min-height 0.3s, height 0.3s;">
                <p id="quoteText" class="quote-text" style="margin: 0; white-space: normal;"></p>
            </div>
            <br>
        </div>
    </section>
                        
    <section class="search-section" id="search">
      <div class="container">
        <h2 style="font-size: 2.5rem; margin-bottom: 2rem">Find Your Food</h2>

        <div class="filters-section" style="background: #d6d4f3a8; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); padding: 1.5rem 1rem;">
          <div class="filter-group">
            <h3>Nutritional Filters <i class="fas fa-chevron-down"></i></h3>
            <div class="filter-options">
              <h4>Calories</h4>
              <label><input type="radio" name="calories" value="all" checked> All</label>
              <label><input type="radio" name="calories" value="low"> Low Calorie (&lt; 200 kcal)</label>
              <label><input type="radio" name="calories" value="moderate"> Moderate Calorie (200-500 kcal)</label>
              <label><input type="radio" name="calories" value="high"> High Calorie (&gt; 500 kcal)</label>

              <h4>Macronutrients</h4>
              <label><input type="checkbox" name="nutrient_focus" value="high_protein"> High Protein</label>
              <label><input type="checkbox" name="nutrient_focus" value="low_fat"> Low Fat</label>
              <label><input type="checkbox" name="nutrient_focus" value="high_fibre"> High Fibre</label>
              <label><input type="checkbox" name="nutrient_focus" value="low_sugar"> Low Sugar</label>

              <h4>Micronutrients</h4>
              <label><input type="checkbox" name="micronutrient_focus" value="high_calcium"> High Calcium</label>
              <label><input type="checkbox" name="micronutrient_focus" value="high_iron"> High Iron</label>
              <label><input type="checkbox" name="micronutrient_focus" value="high_vitamin_c"> High Vitamin C</label>
              <label><input type="checkbox" name="micronutrient_focus" value="high_folate"> High Folate</label>
            </div>
          </div>

          <div class="filter-group">
            <h3>Dish Type Categories <i class="fas fa-chevron-down"></i></h3>
            <div class="filter-options" id="dish-type-filters">
              </div>
          </div>
        </div>
        
        <div id="active-filters-summary"></div>

        <div id="color-code-legend" style="
            background-color: var(--primary-light);
            border: 1px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            margin: 1.5rem auto 1rem;
            max-width: 600px;
            text-align: left;
            font-size: 0.9rem;
            color: var(--dark);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        ">
            <h4 style="margin-top: 0; margin-bottom: 10px; color: var(--primary-dark); font-family: 'Playfair Display', serif;">Nutrient Badge Guide:</h4>
            <p style="margin-bottom: 5px;">
                <span style="display:inline-block; width: 12px; height: 12px; border-radius: 50%; background-color: #4CAF50; border: 1px solid rgba(0,0,0,0.1); vertical-align: middle;"></span>
                <strong>Green:</strong> Low Calorie (&lt;200 kcal), Low Fat (&lt;5g), or Low Sugar (&lt;5g).
            </p>
            <p style="margin-bottom: 5px;">
                <span style="display:inline-block; width: 12px; height: 12px; border-radius: 50%; background-color: #2196F3; border: 1px solid rgba(0,0,0,0.1); vertical-align: middle;"></span>
                <strong>Blue:</strong> High Protein (&gt;=15g) or Rich in Micronutrients.
            </p>
            <p style="margin-bottom: 5px;">
                <span style="display:inline-block; width: 12px; height: 12px; border-radius: 50%; background-color: #FF9800; border: 1px solid rgba(0,0,0,0.1); vertical-align: middle;"></span>
                <strong>Orange:</strong> High Fibre (&gt;=3g).
            </p>
            <p style="margin-bottom: 0;">
                <span style="display:inline-block; width: 12px; height: 12px; border-radius: 50%; background-color: #F44336; border: 1px solid rgba(0,0,0,0.1); vertical-align: middle;"></span>
                <strong>Red:</strong> High Calorie (&gt;500 kcal).
            </p>
        </div>

        <div class="search-container">
          <input type="text" id="mainSearch" class="main-search-bar" placeholder="Search for Indian food (e.g., Roti, Dal, Idli)..."/>

          <div class="sort-options">
            <label for="sort-by">Sort By:</label>
            <select id="sort-by">
              <option value="default">Relevance</option>
              <option value="calories_asc">Calories (Low to High)</option>
              <option value="calories_desc">Calories (High to Low)</option>
              <option value="protein_desc">Protein (High to Low)</option>
              <option value="fibre_desc">Fibre (High to Low)</option>
              <option value="alphabetical">Name (A-Z)</option>
            </select>
            <button class="clear-filters-btn" id="clear-filters-btn">Clear All Filters</button>
          </div>

          <div id="search-results-container"></div>
          
          <div id="pagination-controls" class="pagination">
              </div>
        </div>
      </div>
    </section>
    <div id="floatingControls">
        <button id="goToTop">↑</button>
        <div id="scrollPercentage">0%</div>
    </div>

    <section class="about-section" id="about-us">
      <div class="container">
        <h2
          style="
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-align: center;
            color: var(--primary-dark);
          "
        >
          About NutriSense
        </h2>
        <p style="font-size: 1.1rem; text-align: center; max-width: 800px; margin: 0 auto 30px;">
          NutriSense is your dedicated companion for exploring the rich and diverse world of Indian cuisine through a nutritional lens. We believe that understanding what you eat is the first step towards a healthier lifestyle.
        </p>
        <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 30px;">
          <div style="flex: 1; min-width: 280px; max-width: 400px; background-color: var(--white); padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); text-align: center;">
            <i class="fas fa-leaf" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
            <h3 style="font-size: 1.5rem; color: var(--primary-dark); margin-bottom: 10px;">Our Mission</h3>
            <p>To empower individuals to make informed dietary choices by providing accessible and accurate nutritional information for traditional Indian dishes.</p>
          </div>
          <div style="flex: 1; min-width: 280px; max-width: 400px; background-color: var(--white); padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); text-align: center;">
            <i class="fas fa-database" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
            <h3 style="font-size: 1.5rem; color: var(--primary-dark); margin-bottom: 10px;">Our Data</h3>
            <p>Our database features a comprehensive collection of Indian food items, meticulously analyzed for calories, macronutrients, and key micronutrients.</p>
          </div>
          <div style="flex: 1; min-width: 280px; max-width: 400px; background-color: var(--white); padding: 25px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); text-align: center;">
            <i class="fas fa-hand-holding-heart" style="font-size: 3rem; color: var(--primary); margin-bottom: 15px;"></i>
            <h3 style="font-size: 1.5rem; color: var(--primary-dark); margin-bottom: 10px;">For Your Well-being</h3>
            <p>Whether you're managing weight, tracking macros, or simply curious, NutriSense is here to support your journey to a healthier and happier you.</p>
          </div>
        </div>
      </div>
    </section>
    <section id="contact-us" class="contact-section" style="background-color: var(--primary-light); padding: 3rem 0;">
      <div class="container">
        <h2 style="font-size: 2.5rem; margin-bottom: 2rem; text-align: center; color: var(--primary-dark);">Contact Us</h2>
        <p style="font-size: 1.1rem; text-align: center; max-width: 800px; margin: 0 auto 30px;">
          We would love to hear from you! Whether you have questions, feedback, or just want to say hello, feel free to reach out.
        </p>
        <div id="contact-success-message" style="display:none; background: #e3fcec; color: #388e3c; border: 1px solid #4caf50; border-radius: 8px; padding: 16px; margin-bottom: 18px; text-align: center; font-weight: 500;">
          Submission successful! Thank you for contacting us.
        </div>
        <form id="contactForm" action="https://formspree.io/f/mblykwog" method="POST" style="max-width: 600px; margin: 0 auto;">
            <input type="text" name="_gotcha" style="position: absolute; left: -9999px; opacity: 0; pointer-events: none;" aria-hidden="true" tabindex="-1" />
          <input type="text" name="name" placeholder="Your Name" required style="width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid var(--light-gray);">
          <input type="email" name="email" placeholder="Your Email" required style="width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid var(--light-gray);">
          <textarea name="message" rows="5" placeholder="Your Message" required style="width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 8px; border: 1px solid var(--light-gray);"></textarea>
          <button type="submit" class="btn btn-primary pulse" style="width: 100%; font-size: 1.1rem;">Send Message</button>
        </form>
      </div>

<script>
  // Show success message if redirected after submission
  document.addEventListener('DOMContentLoaded', function() {
    if (window.location.hash === '#contact-success') {
      var msg = document.getElementById('contact-success-message');
      if (msg) {
        msg.style.display = 'block';
        setTimeout(function() {
          msg.style.display = 'none';
          window.location.hash = '';
        }, 3500);
      }
    }
  });

  document.getElementById('contactForm').addEventListener('submit', async function(event) {
    event.preventDefault(); // Prevent default form submission

    const form = event.target;
    const formData = new FormData(form);
    const submitButton = form.querySelector('button[type="submit"]');

    // Disable button to prevent multiple submissions
    submitButton.disabled = true;
    submitButton.textContent = 'Sending...';

    try {
      const response = await fetch(form.action, {
        method: form.method,
        body: formData,
        headers: {
            'Accept': 'application/json' // Essential for Formspree's JSON response
        }
      });

      if (response.ok) {
        // Form submission successful
        window.location.hash = '#contact-success';
        window.location.reload();
      } else {
        // Form submission failed (e.g., validation error, Formspree not activated)
        const data = await response.json();
        if (data.errors) {
          alert('Form submission failed: ' + data.errors.map(err => err.message).join(', '));
        } else {
          alert('Form submission failed. Please try again.');
        }
        submitButton.disabled = false;
        submitButton.textContent = 'Send Message';
      }
    } catch (error) {
      // Network error or other unexpected issues
      console.error('Error submitting form:', error);
      alert('An error occurred. Please check your internet connection and try again.');
      submitButton.disabled = false;
      submitButton.textContent = 'Send Message';
    }
  });
</script>

<script src="script.js"></script>    
<script>
    document.addEventListener("DOMContentLoaded", function () {
  // --- GLOBAL CONSTANTS ---
  const ITEMS_PER_PAGE = 15;
  let currentPage = 1;

  // --- DOM ELEMENTS ---
  const mobileMenuBtn = document.getElementById("mobileMenuBtn");
  const navLinks = document.getElementById("navLinks");
  const quoteTextElement = document.getElementById("quoteText");
  const searchInput = document.getElementById("mainSearch");
  const resultsContainer = document.getElementById("search-results-container");
  const filterControls = document.querySelectorAll('.filters-section input');
  const sortBySelect = document.getElementById('sort-by');
  const clearFiltersBtn = document.getElementById('clear-filters-btn');
  const dishTypeFiltersContainer = document.getElementById('dish-type-filters');
  const activeFiltersSummary = document.getElementById('active-filters-summary');
  const paginationControls = document.getElementById('pagination-controls');
  // Removed: const popularDishesGrid = document.getElementById('popular-dishes-grid');
  const allDishesList = document.getElementById('all-dishes-list'); // All dishes list element


  // --- DATA ---
  let foodDatabase = [];
  let processedFoodData = [];
  let currentFilteredFoods = [];

  // --- MOBILE MENU ---
  if (mobileMenuBtn && navLinks) { // Added null checks for robustness
    mobileMenuBtn.addEventListener("click", () => {
      navLinks.classList.toggle("active");
    });
  }

  // --- HEALTHY QUOTES ROTATOR ---
  const quotes = [
    '"To eat is a necessity, but to eat intelligently is an art."',
    "Fact: A rainbow on your plate means a variety of nutrients.",
    '"Your body is a temple, but only if you treat it as one."',
    "Fact: Staying hydrated can improve energy levels and brain function.",
    '"Let food be thy medicine and medicine be thy food."',
    "Fact: Healthy fats from avocados and nuts are vital for your health.",
    '"A healthy outside starts from the inside."',
  ];
  let quoteIndex = 0;
  function changeQuote() {
    if (quoteTextElement) { // Added null check
      quoteTextElement.classList.add("animate__animated", "animate__fadeOut");
      setTimeout(() => {
        quoteIndex = (quoteIndex + 1) % quotes.length;
        quoteTextElement.textContent = quotes[quoteIndex];
        quoteTextElement.classList.remove("animate__fadeOut");
        quoteTextElement.classList.add("animate__animated", "animate__fadeIn");
      }, 500);
    }
  }
  if (quoteTextElement) {
    quoteTextElement.textContent = quotes[quoteIndex];
    quoteTextElement.classList.add("animate__animated", "animate__fadeIn");
    setInterval(changeQuote, 5000);
  }

  // --- COLLAPSIBLE FILTER GROUPS ---
  document.querySelectorAll('.filter-group h3').forEach(header => {
      header.addEventListener('click', function() {
          const options = this.nextElementSibling;
          options.classList.toggle('hidden');
          this.classList.toggle('collapsed');
      });
  });

  // --- FOOD DATA LOADING & CATEGORIZATION ---
  async function loadFoodData() {
    // Only show loading spinner in resultsContainer if it's visible or a search is imminent
    // For now, let's keep it for initial load feedback
    if (resultsContainer) {
        resultsContainer.innerHTML = '<div class="loading-spinner"><i class="fas fa-spinner fa-spin"></i> Loading food data...</div>';
    }
    
    try {
      const response = await fetch("foods.json");
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      foodDatabase = await response.json();
      
      // Infer dish types and add `healthy` flags
      processedFoodData = foodDatabase.map(food => {
        const dishName = food["Dish Name"].toLowerCase();
        let dishType = "Other";

        if (dishName.includes("tea") || dishName.includes("coffee") || dishName.includes("drink") || dishName.includes("juice") || dishName.includes("lassi") || dishName.includes("sherbet")) {
          dishType = "Beverage";
        } else if (dishName.includes("roti") || dishName.includes("paratha") || dishName.includes("idli") || dishName.includes("dosa") || dishName.includes("poha") || dishName.includes("upma") || dishName.includes("puri") || dishName.includes("bread")) {
          dishType = "Breakfast";
        } else if (dishName.includes("dal") || dishName.includes("curry") || dishName.includes("sabzi") || dishName.includes("rice") || dishName.includes("biryani") || dishName.includes("thali") || dishName.includes("kofta") || dishName.includes("paneer") || dishName.includes("chicken") || dishName.includes("fish")) {
          dishType = "Main Course";
        } else if (dishName.includes("chutney") || dishName.includes("pickle") || dishName.includes("raita") || dishName.includes("salad") || dishName.includes("papad")) {
          dishType = "Side Dish";
        } else if (dishName.includes("samosa") || dishName.includes("pakora") || dishName.includes("sandwich") || dishName.includes("chaat") || dishName.includes("vada") || dishName.includes("bhel") || dishName.includes("kachori")) {
          dishType = "Snack";
        } else if (dishName.includes("barfi") || dishName.includes("ladoo") || dishName.includes("halwa") || dishName.includes("gulab jamun") || dishName.includes("rasgulla") || dishName.includes("kheer") || dishName.includes("jalebi")) {
          dishType = "Dessert";
        }

        // Add healthy flags based on thresholds (illustrative)
        const calories = parseFloat(food["Calories (kcal)"]);
        const protein = parseFloat(food["Protein (g)"]);
        const fats = parseFloat(food["Fats (g)"]);
        const fibre = parseFloat(food["Fibre (g)"]);
        const freeSugar = parseFloat(food["Free Sugar (g)"]);
        const calcium = food["Calcium (mg)"] !== "" ? parseFloat(food["Calcium (mg)"]) : 0;
        const iron = food["Iron (mg)"] !== "" ? parseFloat(food["Iron (mg)"]) : 0;
        const vitaminC = food["Vitamin C (mg)"] !== "" ? parseFloat(food["Vitamin C (mg)"]) : 0;
        const folate = food["Folate (µg)"] !== "" ? parseFloat(food["Folate (µg)"]) : 0;


        return {
          ...food,
          dishType: dishType,
          isLowCalorie: calories < 200,
          isModerateCalorie: calories >= 200 && calories <= 500,
          isHighCalorie: calories > 500,
          isHighProtein: protein >= 15,
          isLowFat: fats <= 5,
          isHighFibre: fibre >= 3,
          isLowSugar: freeSugar <= 5,
          isHighCalcium: calcium >= 100,
          isHighIron: iron >= 2,
          isHighVitaminC: vitaminC >= 15,
          isHighFolate: folate >= 80,
        };
      });

      populateDishTypeFilters();
      
      // Removed: populatePopularDishes() as per user request

      // Ensure allDishesList exists before attempting to populate
      if (allDishesList) {
        populateAllDishesList();
      } else {
        console.warn("Element with ID 'all-dishes-list' not found. All dishes section may not display.");
      }
      
      displayResults();

    } catch (error) {
      console.error("Could not load food database:", error);
      if (resultsContainer) {
        resultsContainer.innerHTML = `<div class="no-results">Could not load food data. Please ensure 'foods.json' is available and try again. If running locally, use a local server (e.g., Live Server).</div>`;
      }
    }
  }

  function populateDishTypeFilters() {
    const dishTypes = [...new Set(processedFoodData.map(food => food.dishType))].sort();
    if (dishTypeFiltersContainer) { // Ensure the container exists
        dishTypeFiltersContainer.innerHTML = '';
        dishTypes.forEach(type => {
          const button = document.createElement('button');
          button.className = 'btn';
          button.textContent = type;
          button.setAttribute('data-dish-type', type);
          button.addEventListener('click', function() {
            this.classList.toggle('active');
            currentPage = 1;
            displayResults();
          });
          dishTypeFiltersContainer.appendChild(button);
        });
    }
  }

  // Removed: populatePopularDishes function


  // --- NEW: POPULATE ALL DISHES LIST ---
  function populateAllDishesList() {
    if (allDishesList) { // Added null check here
        allDishesList.innerHTML = ''; // Clear previous content
        // Filter out generic items or non-distinctly Indian items if necessary, or include all
        const indianDishes = processedFoodData.filter(food => {
            // Simple check for now, can be expanded for more precise filtering
            const dishNameLower = food["Dish Name"].toLowerCase();
            return !dishNameLower.includes("instant coffee") &&
                   !dishNameLower.includes("espreso coffee") &&
                   !dishNameLower.includes("sandwich") && // Exclude generic sandwiches
                   !dishNameLower.includes("plain paratha") && // Exclude if specific parathas are listed
                   !dishNameLower.includes("plain roti"); // Exclude if specific rotis are listed
            // You can add more specific rules here if needed to filter what appears in 'all dishes'
        }).sort((a, b) => a["Dish Name"].localeCompare(b["Dish Name"])); // Sort alphabetically

        indianDishes.forEach(food => {
          const listItem = document.createElement('li');
          listItem.innerHTML = `
            <span class="all-dish-name">${food["Dish Name"]}</span>
            <span class="all-dish-calories">${food["Calories (kcal)"] ? `${food["Calories (kcal)"]} kcal` : 'N/A kcal'}</span>
          `;
          listItem.addEventListener('click', () => {
            searchInput.value = food["Dish Name"];
            // Clear existing filters for a clean search
            if (document.querySelector('input[name="calories"][value="all"]')) {
                document.querySelector('input[name="calories"][value="all"]').checked = true;
            }
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
            document.querySelectorAll('#dish-type-filters .btn.active').forEach(button => button.classList.remove('active'));
            if (sortBySelect) {
                sortBySelect.value = 'default';
            }

            currentPage = 1; // Reset to first page
            displayResults(); // Trigger display results to show the specific item
            
            // Scroll to the search section
            const searchSection = document.getElementById('search');
            if (searchSection) {
                searchSection.scrollIntoView({ behavior: 'smooth' });
            }
          });
          allDishesList.appendChild(listItem);
        });
    }
  }

  // --- FILTERING LOGIC ---
  function applyFilters(foods) {
      const query = searchInput.value.toLowerCase().trim();
      
      return foods.filter(food => {
          // Search query match
          if (query && !food["Dish Name"].toLowerCase().includes(query)) {
              return false;
          }

          // Nutritional Filters
          const caloriesFilter = document.querySelector('input[name="calories"]:checked')?.value || 'all'; // Added optional chaining
          if (caloriesFilter === "low" && !food.isLowCalorie) return false;
          if (caloriesFilter === "moderate" && !food.isModerateCalorie) return false;
          if (caloriesFilter === "high" && !food.isHighCalorie) return false;

          if (document.querySelector('input[name="nutrient_focus"][value="high_protein"]')?.checked && !food.isHighProtein) return false;
          if (document.querySelector('input[name="nutrient_focus"][value="low_fat"]')?.checked && !food.isLowFat) return false;
          if (document.querySelector('input[name="nutrient_focus"][value="high_fibre"]')?.checked && !food.isHighFibre) return false;
          if (document.querySelector('input[name="nutrient_focus"][value="low_sugar"]')?.checked && !food.isLowSugar) return false;

          if (document.querySelector('input[name="micronutrient_focus"][value="high_calcium"]')?.checked && !food.isHighCalcium) return false;
          if (document.querySelector('input[name="micronutrient_focus"][value="high_iron"]')?.checked && !food.isHighIron) return false;
          if (document.querySelector('input[name="micronutrient_focus"][value="high_vitamin_c"]')?.checked && !food.isHighVitaminC) return false;
          if (document.querySelector('input[name="micronutrient_focus"][value="high_folate"]')?.checked && !food.isHighFolate) return false;

          // Dish Type Filters
          const activeDishTypeButtons = document.querySelectorAll('#dish-type-filters .btn.active');
          if (activeDishTypeButtons.length > 0) {
              const selectedDishTypes = Array.from(activeDishTypeButtons).map(btn => btn.dataset.dishType);
              if (!selectedDishTypes.includes(food.dishType)) {
                  return false;
              }
          }
          
          return true;
      });
  }

  // --- SORTING LOGIC ---
  function applySorting(foods) {
      const sortOrder = sortBySelect?.value || 'default'; // Added optional chaining
      foods.sort((a, b) => {
          switch (sortOrder) {
              case 'calories_asc': return parseFloat(a["Calories (kcal)"]) - parseFloat(b["Calories (kcal)"]);
              case 'calories_desc': return parseFloat(b["Calories (kcal)"]) - parseFloat(a["Calories (kcal)"]);
              case 'protein_desc': return parseFloat(b["Protein (g)"]) - parseFloat(a["Protein (g)"]);
              case 'fibre_desc': return parseFloat(b["Fibre (g)"]) - parseFloat(a["Fibre (g)"]);
              case 'alphabetical': return a["Dish Name"].localeCompare(b["Dish Name"]);
              default: return 0;
          }
      });
      return foods;
  }

  // --- MAIN DISPLAY FUNCTION ---
  function displayResults() {
    if (!resultsContainer) return; // Exit if results container is not found

    resultsContainer.innerHTML = "";
    const existingDetailTable = document.getElementById("detailed-info-table");
    if (existingDetailTable) {
      existingDetailTable.remove();
    }
    const existingTip = document.querySelector('.contextual-tip');
    if (existingTip) {
        existingTip.remove();
    }

    currentFilteredFoods = applyFilters(processedFoodData);
    currentFilteredFoods = applySorting(currentFilteredFoods);

    updateFilterSummary();

    if (currentFilteredFoods.length === 0) {
      resultsContainer.innerHTML = `<div class="no-results">No results found for your search and filter criteria. Try broadening your search or clearing filters. You might also explore our <a href="#allDishes" style="color:var(--primary); text-decoration:underline;">all dishes</a> below.</div>`; // Changed link to allDishes
      if (paginationControls) { // Added null check
          paginationControls.innerHTML = '';
      }
      return;
    }

    // Exact match logic - IMPORTANT: This needs to be checked against the *original* foodDatabase
    // to ensure a popular dish click or direct search displays the full info.
    const query = searchInput.value.toLowerCase().trim();
    const caloriesFilter = document.querySelector('input[name="calories"]:checked')?.value || 'all'; // Added optional chaining
    const otherFiltersApplied = areOtherFiltersApplied();
    
    // Find exact match in the *full* processedFoodData, not just the currently filtered set.
    const exactMatch = processedFoodData.find(food => food["Dish Name"].toLowerCase() === query);

    // Show detailed info if there's an exact match AND no other filters are active (or only default calorie filter)
    if (exactMatch && !otherFiltersApplied && caloriesFilter === 'all' && query) {
      showDetailedInfo(exactMatch);
      if (paginationControls) { // Added null check
          paginationControls.innerHTML = '';
      }
      return;
    }

    // --- Pagination logic ---
    const totalPages = Math.ceil(currentFilteredFoods.length / ITEMS_PER_PAGE);
    const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
    const endIndex = startIndex + ITEMS_PER_PAGE;
    const paginatedFoods = currentFilteredFoods.slice(startIndex, endIndex);

    paginatedFoods.forEach((food) => {
      const item = document.createElement("div");
      item.className = "search-result-item";
      
      // Add nutrient badges with Icons
      let badgesHtml = '';
      if (food.isLowCalorie) badgesHtml += `<span class="badge badge-low-calorie" title="Low Calorie"><i class="fas fa-leaf"></i></span>`; // Leaf for healthy/low
      if (food.isHighProtein) badgesHtml += `<span class="badge badge-high-protein" title="High Protein"><i class="fas fa-fish"></i></span>`; // Fish/meat for protein
      if (food.isHighFibre) badgesHtml += `<span class="badge badge-high-fibre" title="High Fibre"><i class="fas fa-wheat-awn"></i></span>`; // Wheat for fiber
      if (food.isLowSugar) badgesHtml += `<span class="badge badge-low-sugar" title="Low Sugar"><i class="fas fa-candy-cane" style="transform: rotate(45deg);"></i></span>`; // Candy cane with rotation for "no sugar" hint
      if (food.isHighCalcium) badgesHtml += `<span class="badge badge-high-nutrient" title="Rich in Calcium"><i class="fas fa-bone"></i></span>`; // Bone for calcium
      if (food.isHighIron) badgesHtml += `<span class="badge badge-high-nutrient" title="Rich in Iron"><i class="fas fa-tint"></i></span>`; // Drop for blood/iron
      if (food.isHighVitaminC) badgesHtml += `<span class="badge badge-high-nutrient" title="Rich in Vitamin C"><i class="fas fa-sun"></i></span>`; // Sun for Vitamin C
      if (food.isHighFolate) badgesHtml += `<span class="badge badge-high-nutrient" title="Rich in Folate"><i class="fas fa-dna"></i></span>`; // DNA for Folate/B-vitamins
      if (food.isHighCalorie) badgesHtml += `<span class="badge badge-high-calorie" title="High Calorie"><i class="fas fa-fire"></i></span>`; // Fire for high calorie

      item.innerHTML = `
        <span class="food-name">${food["Dish Name"]}</span>
        <span class="food-details">
          ${food["Calories (kcal)"] ? `<b>${food["Calories (kcal)"]}</b> kcal` : ""} 
          ${food["Protein (g)"] ? ` | <b>${food["Protein (g)"]}</b>g Protein` : ""}
          ${food.dishType ? ` | ${food.dishType}` : ""}
          ${badgesHtml}
        </span>
      `;
      item.style.cursor = "pointer";
      item.addEventListener("click", () => {
        searchInput.value = food["Dish Name"];
        if (resultsContainer) { // Added null check
            resultsContainer.innerHTML = "";
        }
        showDetailedInfo(food);
        if (paginationControls) { // Added null check
            paginationControls.innerHTML = '';
        }
      });
      resultsContainer.appendChild(item);
    });

    updatePaginationControls(totalPages);
  }

  // --- DETAILED INFO DISPLAY ---
  function showDetailedInfo(food) {
    if (!resultsContainer) return; // Exit if results container is not found

    const existingTable = document.getElementById("detailed-info-table");
    if (existingTable) {
      existingTable.remove();
    }
    const existingTip = document.querySelector('.contextual-tip');
    if (existingTip) {
        existingTip.remove();
    }

    const table = document.createElement("table");
    table.id = "detailed-info-table";
    table.style.width = "100%";
    table.style.borderCollapse = "collapse";
    table.style.marginTop = "1rem";
    table.style.backgroundColor = "var(--white)";
    table.style.boxShadow = "0 5px 15px rgba(0, 0, 0, 0.15)";
    table.style.borderRadius = "8px";
    table.style.overflow = "hidden";
    table.style.border = "3px solid var(--primary-dark)";

    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    const th1 = document.createElement("th");
    th1.textContent = "Nutrient";
    th1.style.borderBottom = "2px solid var(--light-gray)";
    th1.style.padding = "10px";
    th1.style.textAlign = "center";
    th1.style.fontWeight = "bold";
    const th2 = document.createElement("th");
    th2.textContent = "Value";
    th2.style.borderBottom = "2px solid var(--light-gray)";
    th2.style.padding = "10px";
    th2.style.textAlign = "center";
    th2.style.fontWeight = "bold";
    headerRow.appendChild(th1);
    headerRow.appendChild(th2);
    thead.appendChild(headerRow);
    table.appendChild(thead);

    const tbody = document.createElement("tbody");

    for (const key in food) {
      if (food.hasOwnProperty(key) && !['dishType', 'isLowCalorie', 'isModerateCalorie', 'isHighCalorie', 'isHighProtein', 'isLowFat', 'isHighFibre', 'isLowSugar', 'isHighCalcium', 'isHighIron', 'isHighVitaminC', 'isHighFolate'].includes(key)) {
        const match = key.match(/^(.+?)\s*\(([^)]+)\)$/m); // Changed to multiline match for safety
        let nutrient = key;
        let units = "";
        if (match) {
          nutrient = match[1].trim();
          units = match[2].trim();
        }

        const row = document.createElement("tr");
        const tdKey = document.createElement("td");
        tdKey.textContent = nutrient;
        tdKey.style.borderBottom = "1px solid var(--light-gray)";
        tdKey.style.padding = "8px";
        tdKey.style.textAlign = "center";
        tdKey.style.fontWeight = "bold";

        const tdValue = document.createElement("td");
        if (key.toLowerCase().includes("dish name")) {
          tdValue.innerHTML = `<b>${food[key]}</b>`;
        } else {
          tdValue.textContent = food[key] + (units ? " " + units : "");
        }
        tdValue.style.borderBottom = "1px solid var(--light-gray)";
        tdValue.style.padding = "8px";
        tdValue.style.textAlign = "center";
        row.appendChild(tdKey);
        row.appendChild(tdValue);
        tbody.appendChild(row);
      }
    }

    table.appendChild(tbody);
    // Ensure parentNode exists before appending
    if (resultsContainer.parentNode) {
        resultsContainer.parentNode.appendChild(table);
    }


    // Add Contextual Tips
    const tipsContainer = document.createElement('div');
    tipsContainer.className = 'contextual-tip';
    let tipsAdded = false;

    const calories = parseFloat(food["Calories (kcal)"]);
    const protein = parseFloat(food["Protein (g)"]);
    const fibre = parseFloat(food["Fibre (g)"]);
    const freeSugar = parseFloat(food["Free Sugar (g)"]);
    const iron = food["Iron (mg)"] !== "" ? parseFloat(food["Iron (mg)"]) : 0;
    const vitaminC = food["Vitamin C (mg)"] !== "" ? parseFloat(food["Vitamin C (mg)"]) : 0;

    if (calories > 400 && food.dishType !== "Main Course") {
        tipsContainer.innerHTML += '<p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> This is a calorie-dense item. Consider portion control or balancing it with lighter options in your meal.</p>';
        tipsAdded = true;
    }
    if (freeSugar > 10) { // Example for high sugar
        tipsContainer.innerHTML += '<p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> This item is relatively high in sugar. Enjoy in moderation or look for lower-sugar alternatives.</p>';
        tipsAdded = true;
    }
    if (protein < 5 && food.dishType !== "Beverage" && food.dishType !== "Side Dish") { // Low protein for non-beverage/side
        tipsContainer.innerHTML += '<p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Boost your meal\'s protein by adding dal, paneer, or lean meat.</p>';
        tipsAdded = true;
    }
    if (fibre < 1 && food.dishType !== "Beverage") { // Low fiber for non-beverage
        tipsContainer.innerHTML += '<p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Pair this with a high-fiber salad or vegetable side dish for a balanced meal.</p>';
        tipsAdded = true;
    }
    if (iron < 1 && food.dishType !== "Beverage") { // Example low iron
        tipsContainer.innerHTML += '<p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> Boost iron intake! Pair with Vitamin C rich foods (like citrus) to enhance absorption, or add dark leafy greens.</p>';
        tipsAdded = true;
    }
    if (vitaminC < 5 && food.dishType !== "Beverage") { // Example low Vitamin C
        tipsContainer.innerHTML += '<p><i class="fas fa-lightbulb"></i> <strong>Tip:</strong> To get more Vitamin C, include fresh fruits (like amla, orange) or bell peppers in your diet.</p>';
        tipsAdded = true;
    }


    if (tipsAdded) {
        if (resultsContainer.parentNode) { // Ensure parentNode exists
            resultsContainer.parentNode.appendChild(tipsContainer);
        }
    }
  }

  // --- FILTER SUMMARY ---
  function getActiveFiltersList() {
      const active = [];

      // Calories
      const caloriesFilter = document.querySelector('input[name="calories"]:checked')?.value || 'all'; // Added optional chaining
      if (caloriesFilter !== "all") {
          active.push({ name: document.querySelector(`input[name="calories"][value="${caloriesFilter}"]`).parentNode.textContent.trim(), type: 'calorie' });
      }

      // Macronutrients
      document.querySelectorAll('input[name="nutrient_focus"]:checked').forEach(checkbox => {
          active.push({ name: checkbox.parentNode.textContent.trim(), type: 'nutrient' });
      });

      // Micronutrients
      document.querySelectorAll('input[name="micronutrient_focus"]:checked').forEach(checkbox => {
          active.push({ name: checkbox.parentNode.textContent.trim(), type: 'micronutrient' });
      });

      // Dish Types
      document.querySelectorAll('#dish-type-filters .btn.active').forEach(button => {
          active.push({ name: button.textContent.trim(), type: 'dishType' });
      });

      // Search Query - MODIFIED TO INCLUDE TYPE for reliable clearing
      const query = searchInput.value.trim();
      if (query) {
          active.push({ name: `"${query}"`, type: 'query' }); // Store type as 'query'
      }
      return active;
  }

  function updateFilterSummary() {
      if (!activeFiltersSummary) return; // Exit if summary element not found

      activeFiltersSummary.innerHTML = '';
      const activeFilters = getActiveFiltersList();
      if (activeFilters.length > 0) {
          // Changed how data-filter-type is set for clarity and reliability
          const summaryHtml = `<strong>Active Filters:</strong> ${activeFilters.map(filter => `<span class="filter-tag">${filter.name} <i class="fas fa-times-circle" data-filter-name="${filter.name}" data-filter-type="${filter.type}"></i></span>`).join('')}`;
          activeFiltersSummary.innerHTML = summaryHtml;

          // Add event listeners to remove filter tags
          activeFiltersSummary.querySelectorAll('.filter-tag i').forEach(icon => {
              icon.addEventListener('click', function() {
                  const filterName = this.dataset.filterName;
                  const filterType = this.dataset.filterType; // Retrieve the new type
                  removeFilter(filterName, filterType); // Pass both name and type
                  currentPage = 1;
                  displayResults();
              });
          });
      }
  }

  function removeFilter(filterName, filterType) { // Modified to accept filterType for robust clearing
      if (filterType === 'calorie') {
          document.querySelector('input[name="calories"][value="all"]').checked = true;
      } else if (filterType === 'nutrient' || filterType === 'micronutrient') {
          // This logic works by matching the displayed text of the checkbox/button
          document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
              if (checkbox.parentNode.textContent.trim() === filterName) {
                  checkbox.checked = false;
              }
          });
      } else if (filterType === 'dishType') {
          document.querySelectorAll('#dish-type-filters .btn').forEach(button => {
              if (button.textContent.trim() === filterName) {
                  button.classList.remove('active');
              }
          });
      } else if (filterType === 'query') { // Now we check the explicit type 'query'
          searchInput.value = '';
      }
  }

  function areOtherFiltersApplied() {
    const nutrientFocusCheckboxes = document.querySelectorAll('input[name="nutrient_focus"]:checked');
    if (nutrientFocusCheckboxes.length > 0) return true;

    const micronutrientFocusCheckboxes = document.querySelectorAll('input[name="micronutrient_focus"]:checked');
    if (micronutrientFocusCheckboxes.length > 0) return true;

    const activeDishTypeButtons = document.querySelectorAll('#dish-type-filters .btn.active');
    if (activeDishTypeButtons.length > 0) return true;

    const query = searchInput.value.trim();
    if (query) return true;

    // Check if any calorie filter other than 'all' is selected
    const caloriesFilter = document.querySelector('input[name="calories"]:checked')?.value || 'all';
    if (caloriesFilter !== 'all') return true;

    return false;
  }

  // --- PAGINATION CONTROLS ---
  function updatePaginationControls(totalPages) {
      if (!paginationControls) return; // Exit if pagination controls not found

      paginationControls.innerHTML = '';
      if (totalPages <= 1) return;

      // Previous Button
      const prevButton = document.createElement('button');
      prevButton.textContent = 'Previous';
      prevButton.disabled = currentPage === 1;
      prevButton.addEventListener('click', () => {
          if (currentPage > 1) {
              currentPage--;
              displayResults();
          }
      });
      paginationControls.appendChild(prevButton);

      // Page Number Buttons
      const maxPageButtons = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxPageButtons / 2));
      let endPage = Math.min(totalPages, startPage + maxPageButtons - 1);

      if (endPage - startPage + 1 < maxPageButtons) {
          startPage = Math.max(1, endPage - maxPageButtons + 1);
      }

      for (let i = startPage; i <= endPage; i++) {
          const pageButton = document.createElement('button');
          pageButton.textContent = i;
          if (i === currentPage) {
              pageButton.classList.add('active');
          }
          pageButton.addEventListener('click', () => {
              currentPage = i;
              displayResults();
          });
          paginationControls.appendChild(pageButton);
      }

      // Next Button
      const nextButton = document.createElement('button');
      nextButton.textContent = 'Next';
      nextButton.disabled = currentPage === totalPages;
      nextButton.addEventListener('click', () => {
          if (currentPage < totalPages) {
              currentPage++;
              displayResults();
          }
      });
      paginationControls.appendChild(nextButton);
  }

  // --- EVENT LISTENERS ---
  if (searchInput) { // Added null check
      searchInput.addEventListener("input", () => {
          currentPage = 1;
          displayResults();
      });
  }

  filterControls.forEach(control => {
    control.addEventListener('change', () => {
      currentPage = 1;
      displayResults();
    });
  });

  if (sortBySelect) { // Added null check
      sortBySelect.addEventListener('change', () => {
          currentPage = 1;
          displayResults();
      });
  }

  if (clearFiltersBtn) { // Added null check
      clearFiltersBtn.addEventListener('click', () => {
        if (searchInput) searchInput.value = '';
        if (document.querySelector('input[name="calories"][value="all"]')) {
            document.querySelector('input[name="calories"][value="all"]').checked = true;
        }
        document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
        document.querySelectorAll('#dish-type-filters .btn.active').forEach(button => button.classList.remove('active'));
        if (sortBySelect) sortBySelect.value = 'default';
        currentPage = 1;
        displayResults();
      });
  }

  loadFoodData();
});

// Add new DOM element for local search
const allDishesLocalSearchInput = document.getElementById('all-dishes-local-search');
const groupedAllDishesList = document.getElementById('grouped-all-dishes-list'); // New container for grouped lists

// Modify populateAllDishesList to support grouping and local search
function populateAllDishesList(filterQuery = '') {
    if (!groupedAllDishesList) { // Use the new grouped container
        console.warn("Element with ID 'grouped-all-dishes-list' not found. All dishes section may not display correctly.");
        return;
    }
    groupedAllDishesList.innerHTML = ''; // Clear previous content

    // Filter dishes based on local search query if provided
    const dishesToDisplay = processedFoodData.filter(food => {
        const dishNameLower = food["Dish Name"].toLowerCase();
        // Exclude generic items as before
        if (dishNameLower.includes("instant coffee") || dishNameLower.includes("espreso coffee") || 
            dishNameLower.includes("sandwich") || dishNameLower.includes("plain paratha") || 
            dishNameLower.includes("plain roti")) {
            return false;
        }
        // Apply local search filter
        return dishNameLower.includes(filterQuery.toLowerCase());
    }).sort((a, b) => a["Dish Name"].localeCompare(b["Dish Name"]));

    // Group dishes by first letter
    const grouped = dishesToDisplay.reduce((acc, food) => {
        const firstLetter = food["Dish Name"].charAt(0).toUpperCase();
        if (!acc[firstLetter]) {
            acc[firstLetter] = [];
        }
        acc[firstLetter].push(food);
        return acc;
    }, {});

    const sortedLetters = Object.keys(grouped).sort();

    // Generate Alphabet Jump Links
    const alphabetJumpLinksContainer = document.querySelector('.alphabet-jump-links');
    if (alphabetJumpLinksContainer) {
        alphabetJumpLinksContainer.innerHTML = '';
        sortedLetters.forEach(letter => {
            const span = document.createElement('span');
            span.textContent = letter;
            span.className = 'alphabet-jump-link';
            span.onclick = () => {
                const targetHeader = document.getElementById(`all-dishes-group-${letter}`);
                if (targetHeader) {
                    targetHeader.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            };
            alphabetJumpLinksContainer.appendChild(span);
        });
    }


    sortedLetters.forEach(letter => {
        const groupHeader = document.createElement('h3');
        groupHeader.id = `all-dishes-group-${letter}`; // For jump links
        groupHeader.className = 'all-dishes-group-header collapsible-header'; // Add collapsible classes
        groupHeader.innerHTML = `${letter} <i class="fas fa-chevron-down"></i>`; // Add icon
        
        const groupList = document.createElement('ul');
        groupList.className = 'all-dishes-group-list collapsible-content'; // Add collapsible classes

        grouped[letter].forEach(food => {
            const listItem = document.createElement('li');
            listItem.innerHTML = `
                <span class="all-dish-name">${food["Dish Name"]}</span>
                <span class="all-dish-calories">${food["Calories (kcal)"] ? `${food["Calories (kcal)"]} kcal` : 'N/A kcal'}</span>
            `;
            // Re-use existing click handler logic
            listItem.addEventListener('click', () => {
                searchInput.value = food["Dish Name"];
                // ... (your existing filter clearing logic) ...
                currentPage = 1;
                displayResults();
                const searchSection = document.getElementById('search');
                if (searchSection) {
                    searchSection.scrollIntoView({ behavior: 'smooth' });
                }
            });
            groupList.appendChild(listItem);
        });

        groupedAllDishesList.appendChild(groupHeader);
        groupedAllDishesList.appendChild(groupList);
    });

    // Re-apply collapsible header logic for new headers
    document.querySelectorAll('.all-dishes-group-header').forEach(header => {
        header.addEventListener('click', function() {
            const content = this.nextElementSibling;
            content.classList.toggle('hidden'); // Assuming you have a .hidden class
            this.querySelector('i').classList.toggle('fa-chevron-down');
            this.querySelector('i').classList.toggle('fa-chevron-up');
        });
    });
}

// Add event listener for the new local search bar
if (allDishesLocalSearchInput) {
    allDishesLocalSearchInput.addEventListener('input', () => {
        populateAllDishesList(allDishesLocalSearchInput.value);
    });
}

</script>
</div>
    <footer style="background-color: var(--primary-dark); color: white; padding: 15px 0; text-align: center;"> <div class="container">
        <p>&copy; 2025 NutriSense ~ Neo-Athelios. All rights reserved.</p>
        <p>
          Follow us on
          <a href="#" style="color: var(--white); text-decoration: underline;">Instagram</a>,
          <a href="#" style="color: var(--white); text-decoration: underline;">Facebook</a>,
          <a href="#" style="color: var(--white); text-decoration: underline;">Twitter</a>
        </p>
      </div>
    </footer>
  </body>
</html>